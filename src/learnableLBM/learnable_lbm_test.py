import learnableLBM as ll
import numpy as np
import unittest
import pprint

class TestInputField(unittest.TestCase):
    """test class of InputField
    """

    def test_normal(self):
        arg_u_vert = np.array([
            [0.12, 0.08],
            [-0.07, 0.05]
        ])
        arg_u_hori = np.array([
            [-0.03, 0.04],
            [-0.1, 0.1]
        ])
        arg_rho = np.array([
            [100.0, 110.0],
            [120.0, 90.0]
        ])
        expected = np.array([
            [
                [[2.065277778, 7.576111111, 1.745277778],
                [11.90111111, 43.42444444, 9.901111111],
                [4.245277778, 15.57611111, 3.565277778]],   # (0, 0)
                [[2.116888889, 9.494222222, 2.674222222],
                [10.69688889, 48.30222222, 13.63022222],
                [3.407555556, 15.36088889, 4.316888889]],   # (0, 1)
            ],
            [
                [[5.392333333, 16.12933333, 2.972333333],
                [17.63533333, 52.14133333, 9.635333333],
                [3.572333333, 10.52933333, 1.992333333]],   # (1, 0)
                [[1.58125, 8.425, 2.85625],
                [7.2625, 39.25, 13.2625],
                [2.10625, 11.425, 3.83125]],                # (1, 1)
            ]
        ])
        input_field = ll.InputField(arg_u_vert, arg_u_hori, arg_rho)
        actual = input_field.f.arr
        # np.testing.assert_array_almost_equal(expected, actual)
        self.assertTrue(np.allclose(expected, actual))
        self.assertTrue(np.allclose(input_field.u_vert.arr, arg_u_vert))
        self.assertTrue(np.allclose(input_field.u_hori.arr, arg_u_hori))
        self.assertTrue(np.allclose(input_field.rho.arr, arg_rho))

class TestStreamedField(unittest.TestCase):
    """test class of StreamedField
    """

    def test_stream_1(self):
        arg_f0_nparr = np.array([
            [
                [
                    [1.0000000000,2.0000000000,3.0000000000,],
                    [10.0000000000,11.0000000000,12.0000000000,],
                    [19.0000000000,20.0000000000,21.0000000000,],
                ],
                [
                    [4.0000000000,5.0000000000,6.0000000000,],
                    [13.0000000000,14.0000000000,15.0000000000,],
                    [22.0000000000,23.0000000000,24.0000000000,],
                ],
                [
                    [7.0000000000,8.0000000000,9.0000000000,],
                    [16.0000000000,17.0000000000,18.0000000000,],
                    [25.0000000000,26.0000000000,27.0000000000,],
                ],
            ],
            [
                [
                    [28.0000000000,29.0000000000,30.0000000000,],
                    [37.0000000000,38.0000000000,39.0000000000,],
                    [46.0000000000,47.0000000000,48.0000000000,],
                ],
                [
                    [31.0000000000,32.0000000000,33.0000000000,],
                    [40.0000000000,41.0000000000,42.0000000000,],
                    [49.0000000000,50.0000000000,51.0000000000,],
                ],
                [
                    [34.0000000000,35.0000000000,36.0000000000,],
                    [43.0000000000,44.0000000000,45.0000000000,],
                    [52.0000000000,53.0000000000,54.0000000000,],
                ],
            ],
            [
                [
                    [55.0000000000,56.0000000000,57.0000000000,],
                    [64.0000000000,65.0000000000,66.0000000000,],
                    [73.0000000000,74.0000000000,75.0000000000,],
                ],
                [
                    [58.0000000000,59.0000000000,60.0000000000,],
                    [67.0000000000,68.0000000000,69.0000000000,],
                    [76.0000000000,77.0000000000,78.0000000000,],
                ],
                [
                    [61.0000000000,62.0000000000,63.0000000000,],
                    [70.0000000000,71.0000000000,72.0000000000,],
                    [79.0000000000,80.0000000000,81.0000000000,],
                ],
            ],
        ])
        arg_w0_nparr = np.array([
            [
                [
                    [1.0000000000,10.0000000000,19.0000000000,],
                    [2.0000000000,11.0000000000,20.0000000000,],
                    [3.0000000000,12.0000000000,21.0000000000,],
                ],
                [
                    [28.0000000000,37.0000000000,46.0000000000,],
                    [29.0000000000,38.0000000000,47.0000000000,],
                    [30.0000000000,39.0000000000,48.0000000000,],
                ],
                [
                    [55.0000000000,64.0000000000,73.0000000000,],
                    [56.0000000000,65.0000000000,74.0000000000,],
                    [57.0000000000,66.0000000000,75.0000000000,],
                ],
            ],
            [
                [
                    [4.0000000000,13.0000000000,22.0000000000,],
                    [5.0000000000,14.0000000000,23.0000000000,],
                    [6.0000000000,15.0000000000,24.0000000000,],
                ],
                [
                    [31.0000000000,40.0000000000,49.0000000000,],
                    [32.0000000000,41.0000000000,50.0000000000,],
                    [33.0000000000,42.0000000000,51.0000000000,],
                ],
                [
                    [58.0000000000,67.0000000000,76.0000000000,],
                    [59.0000000000,68.0000000000,77.0000000000,],
                    [60.0000000000,69.0000000000,78.0000000000,],
                ],
            ],
            [
                [
                    [7.0000000000,16.0000000000,25.0000000000,],
                    [8.0000000000,17.0000000000,26.0000000000,],
                    [9.0000000000,18.0000000000,27.0000000000,],
                ],
                [
                    [34.0000000000,43.0000000000,52.0000000000,],
                    [35.0000000000,44.0000000000,53.0000000000,],
                    [36.0000000000,45.0000000000,54.0000000000,],
                ],
                [
                    [61.0000000000,70.0000000000,79.0000000000,],
                    [62.0000000000,71.0000000000,80.0000000000,],
                    [63.0000000000,72.0000000000,81.0000000000,],
                ],
            ],
        ])
        arg_w1_nparr = np.array([
            [
                [
                    [81.0000000000,80.0000000000,79.0000000000,],
                    [72.0000000000,71.0000000000,70.0000000000,],
                    [63.0000000000,62.0000000000,61.0000000000,],
                ],
                [
                    [78.0000000000,77.0000000000,76.0000000000,],
                    [69.0000000000,68.0000000000,67.0000000000,],
                    [60.0000000000,59.0000000000,58.0000000000,],
                ],
                [
                    [75.0000000000,74.0000000000,73.0000000000,],
                    [66.0000000000,65.0000000000,64.0000000000,],
                    [57.0000000000,56.0000000000,55.0000000000,],
                ],
            ],
            [
                [
                    [54.0000000000,53.0000000000,52.0000000000,],
                    [45.0000000000,44.0000000000,43.0000000000,],
                    [36.0000000000,35.0000000000,34.0000000000,],
                ],
                [
                    [51.0000000000,50.0000000000,49.0000000000,],
                    [42.0000000000,41.0000000000,40.0000000000,],
                    [33.0000000000,32.0000000000,31.0000000000,],
                ],
                [
                    [48.0000000000,47.0000000000,46.0000000000,],
                    [39.0000000000,38.0000000000,37.0000000000,],
                    [30.0000000000,29.0000000000,28.0000000000,],
                ],
            ],
            [
                [
                    [27.0000000000,26.0000000000,25.0000000000,],
                    [18.0000000000,17.0000000000,16.0000000000,],
                    [9.0000000000,8.0000000000,7.0000000000,],
                ],
                [
                    [24.0000000000,23.0000000000,22.0000000000,],
                    [15.0000000000,14.0000000000,13.0000000000,],
                    [6.0000000000,5.0000000000,4.0000000000,],
                ],
                [
                    [21.0000000000,20.0000000000,19.0000000000,],
                    [12.0000000000,11.0000000000,10.0000000000,],
                    [3.0000000000,2.0000000000,1.0000000000,],
                ],
            ],
        ])
        arg_f0 = ll.pyarr4d(arg_f0_nparr, 0, 0)
        arg_w0 = ll.pyarr4d(arg_w0_nparr, 0, 0)
        arg_w1 = ll.pyarr4d(arg_w1_nparr, 0, 0)
        expected_f_nparr = np.array([
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [3142.0000000000,2990.0000000000,2842.0000000000,],
                    [1838.0000000000,1722.0000000000,1610.0000000000,],
                    [858.0000000000,778.0000000000,702.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
        ])
        expected_u_vert_nparr = np.array([
            [0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,-0.4026210411,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,],
        ])
        expected_u_hori_nparr = np.array([
            [0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,-0.0414998180,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,],
        ])
        expected_rho_nparr = np.array([
            [0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,16482.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,],
        ])
        expected_f = ll.pyarr4d(expected_f_nparr, 1, 1)
        expected_u_vert = ll.pyarr2d(expected_u_vert_nparr, 1, 1)
        expected_u_hori = ll.pyarr2d(expected_u_hori_nparr, 1, 1)
        expected_rho = ll.pyarr2d(expected_rho_nparr, 1, 1)
        streamed_field = ll.StreamedField(3, 3, 1, 1)
        streamed_field.stream(arg_f0, arg_w0, arg_w1)
        self.assertTrue(isequal_pyarr4d(streamed_field.f, expected_f))
        self.assertTrue(isequal_pyarr2d(streamed_field.u_vert, expected_u_vert))
        self.assertTrue(isequal_pyarr2d(streamed_field.u_hori, expected_u_hori))
        self.assertTrue(isequal_pyarr2d(streamed_field.rho, expected_rho))

    def test_stream_2(self):
        arg_f0_nparr = np.array([
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [6.4400000000,9.9000000000,1.9500000000,],
                    [3.4600000000,7.5100000000,9.1200000000,],
                    [7.8500000000,2.0100000000,9.3000000000,],
                ],
                [
                    [3.2300000000,4.6500000000,5.0700000000,],
                    [0.0500000000,1.9100000000,2.1300000000,],
                    [7.8500000000,5.5300000000,3.6100000000,],
                ],
                [
                    [5.6800000000,1.1900000000,3.8900000000,],
                    [6.3600000000,3.1800000000,6.3400000000,],
                    [1.8600000000,0.1500000000,5.5700000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [4.2600000000,7.0900000000,8.8600000000,],
                    [3.9900000000,8.3300000000,4.5100000000,],
                    [2.6800000000,2.6600000000,3.0000000000,],
                ],
                [
                    [3.8900000000,7.6200000000,4.9600000000,],
                    [4.2600000000,8.2400000000,7.7800000000,],
                    [7.0800000000,9.7700000000,1.3600000000,],
                ],
                [
                    [1.7900000000,4.5100000000,1.9300000000,],
                    [2.4400000000,9.3100000000,4.8000000000,],
                    [0.6600000000,8.7900000000,7.4700000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [4.9000000000,2.7700000000,5.3000000000,],
                    [1.1000000000,1.9300000000,8.1000000000,],
                    [8.5900000000,0.0900000000,5.0400000000,],
                ],
                [
                    [1.3500000000,0.0500000000,2.8400000000,],
                    [8.2200000000,8.8000000000,5.9300000000,],
                    [3.2400000000,0.2600000000,2.6600000000,],
                ],
                [
                    [7.5400000000,6.0700000000,5.4900000000,],
                    [0.8000000000,4.6800000000,5.7500000000,],
                    [3.5600000000,9.8500000000,5.8700000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [7.8100000000,0.9700000000,1.8700000000,],
                    [6.1400000000,6.1700000000,1.7600000000,],
                    [9.9500000000,2.8800000000,5.1000000000,],
                ],
                [
                    [8.7800000000,9.9800000000,3.3100000000,],
                    [5.1700000000,4.7300000000,4.5500000000,],
                    [9.2900000000,1.8600000000,3.5600000000,],
                ],
                [
                    [6.7500000000,5.4700000000,3.9200000000,],
                    [3.9400000000,9.8000000000,6.8100000000,],
                    [7.6300000000,4.0300000000,2.4100000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
            [
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
                [
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                    [0.0000000000,0.0000000000,0.0000000000,],
                ],
            ],
        ])
        arg_w0_nparr = np.array([
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [7.6900000000,5.8100000000,3.7100000000,],
                [1.3300000000,0.3800000000,0.2400000000,],
                [6.5600000000,8.9500000000,2.6400000000,],
            ],
            [
                [6.1500000000,8.2500000000,4.8100000000,],
                [1.0000000000,6.6100000000,4.0100000000,],
                [7.1800000000,4.9300000000,3.2200000000,],
            ],
            [
                [1.4500000000,1.9300000000,2.4800000000,],
                [6.7200000000,8.5800000000,8.8900000000,],
                [6.8700000000,2.2300000000,3.6100000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [5.2500000000,4.3300000000,3.2800000000,],
                [5.8300000000,3.7700000000,2.7200000000,],
                [3.2000000000,9.0500000000,8.6400000000,],
            ],
            [
                [3.9100000000,5.8900000000,4.1000000000,],
                [0.0600000000,7.4300000000,7.5300000000,],
                [3.2500000000,9.3100000000,6.7300000000,],
            ],
            [
                [7.4500000000,2.9000000000,8.1600000000,],
                [1.0100000000,4.8300000000,6.4300000000,],
                [9.1300000000,7.5400000000,3.7800000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [1.2100000000,6.9500000000,7.0500000000,],
                [8.1400000000,9.4900000000,5.7600000000,],
                [5.9200000000,7.6500000000,8.4100000000,],
            ],
            [
                [0.4500000000,7.7000000000,2.5300000000,],
                [6.9500000000,1.7300000000,1.2900000000,],
                [3.1200000000,2.5800000000,5.1400000000,],
            ],
            [
                [6.7100000000,9.5800000000,3.2500000000,],
                [6.4600000000,3.5200000000,8.3100000000,],
                [2.0500000000,6.4100000000,6.1300000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [6.2800000000,3.5600000000,0.2400000000,],
                [5.0900000000,5.7100000000,1.6600000000,],
                [9.5000000000,5.0700000000,1.4500000000,],
            ],
            [
                [2.6600000000,6.9900000000,7.7100000000,],
                [3.7600000000,6.4200000000,5.5300000000,],
                [1.5800000000,8.3400000000,8.5600000000,],
            ],
            [
                [4.3400000000,3.2200000000,5.4400000000,],
                [4.1900000000,3.3400000000,6.8300000000,],
                [7.3900000000,5.6000000000,9.8800000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
    ])
        arg_w1_nparr = np.array([
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [3.4500000000,5.7400000000,2.3400000000,],
                [2.8400000000,0.8600000000,9.9100000000,],
                [8.9400000000,3.5500000000,0.2700000000,],
            ],
            [
                [7.9500000000,5.6900000000,1.8100000000,],
                [2.3900000000,2.4300000000,0.4700000000,],
                [9.6300000000,4.1000000000,2.2300000000,],
            ],
            [
                [3.6300000000,4.7000000000,5.6100000000,],
                [0.6400000000,2.8100000000,7.0200000000,],
                [5.8900000000,9.3500000000,6.7700000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [9.9600000000,4.0100000000,6.0700000000,],
                [2.5100000000,2.7000000000,3.2700000000,],
                [2.9700000000,9.1700000000,3.2600000000,],
            ],
            [
                [9.8700000000,5.1900000000,3.5800000000,],
                [9.2300000000,5.1400000000,5.0100000000,],
                [5.0300000000,9.6500000000,3.1000000000,],
            ],
            [
                [1.8300000000,9.5100000000,9.1300000000,],
                [8.3900000000,4.9300000000,3.4600000000,],
                [6.4100000000,2.4200000000,5.4500000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [9.5500000000,6.2900000000,9.4000000000,],
                [9.5500000000,3.1200000000,0.2600000000,],
                [1.5800000000,9.4800000000,9.0600000000,],
            ],
            [
                [0.0400000000,7.5100000000,7.7600000000,],
                [9.2400000000,8.1800000000,9.4000000000,],
                [9.3800000000,1.9300000000,2.7300000000,],
            ],
            [
                [0.2400000000,7.2300000000,0.6500000000,],
                [6.0000000000,8.5400000000,8.5900000000,],
                [9.7000000000,6.0200000000,2.1600000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [3.8000000000,5.3500000000,9.0000000000,],
                [9.3000000000,1.0800000000,2.7200000000,],
                [4.2400000000,1.7200000000,2.8500000000,],
            ],
            [
                [4.3300000000,7.7600000000,8.1100000000,],
                [7.1900000000,9.3700000000,3.9600000000,],
                [2.2300000000,7.1100000000,3.0900000000,],
            ],
            [
                [5.0600000000,2.8100000000,0.4600000000,],
                [1.3500000000,4.0700000000,2.1700000000,],
                [2.4900000000,7.9400000000,7.5600000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
    ])
        arg_f0 = ll.pyarr4d(arg_f0_nparr, 1, 1)
        arg_w0 = ll.pyarr4d(arg_w0_nparr, 1, 1)
        arg_w1 = ll.pyarr4d(arg_w1_nparr, 1, 1)
        expected_f_nparr = np.array([
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [78.3298000000,6.1495000000,23.0740000000,],
                [22.5812000000,49.7836000000,30.1251000000,],
                [12.6058000000,62.6745000000,35.5600000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.7200000000,82.6498000000,17.0412000000,],
                [14.3420000000,73.7140000000,77.4300000000,],
                [9.3108000000,21.4361000000,13.3300000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
        [
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
            [
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
                [0.0000000000,0.0000000000,0.0000000000,],
            ],
        ],
    ])
        expected_u_vert_nparr = np.array([
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0102435931,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,-0.1817382044,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
        ])
        expected_u_hori_nparr = np.array([
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,0.00000000,-0.07715479,0.00000000,0.00000000,],
            [0.00000000,0.00000000,0.26914653,0.00000000,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
        ])
        expected_rho_nparr = np.array([
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,320.8835000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,309.9739000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
            [0.0000000000,0.0000000000,0.0000000000,0.0000000000,0.0000000000,],
        ])
        expected_f = ll.pyarr4d(expected_f_nparr, 2, 2)
        expected_u_vert = ll.pyarr2d(expected_u_vert_nparr, 2, 2)
        expected_u_hori = ll.pyarr2d(expected_u_hori_nparr, 2, 2)
        expected_rho = ll.pyarr2d(expected_rho_nparr, 2, 2)
        streamed_field = ll.StreamedField(6, 5, 2, 2)
        streamed_field.stream(arg_f0, arg_w0, arg_w1)
        self.assertTrue(isequal_pyarr4d(streamed_field.f, expected_f))
        self.assertTrue(isequal_pyarr2d(streamed_field.u_vert, expected_u_vert))
        self.assertTrue(isequal_pyarr2d(streamed_field.u_hori, expected_u_hori))
        self.assertTrue(isequal_pyarr2d(streamed_field.rho, expected_rho))

class TestCollidedField(unittest.TestCase):
    """test class of CollidedField
    """

    def test_collide_1(self):
        arg_f_1_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [8.04000000,7.77000000,0.33000000,],
                    [1.84000000,1.53000000,7.15000000,],
                    [6.03000000,4.42000000,1.84000000,],
                ],
                [
                    [3.54000000,1.68000000,3.81000000,],
                    [9.71000000,4.32000000,8.76000000,],
                    [1.68000000,8.78000000,8.91000000,],
                ],
                [
                    [5.86000000,3.29000000,6.41000000,],
                    [9.41000000,0.26000000,9.19000000,],
                    [7.49000000,1.03000000,4.45000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [6.49000000,1.00000000,2.60000000,],
                    [6.08000000,4.99000000,0.42000000,],
                    [8.71000000,8.81000000,6.84000000,],
                ],
                [
                    [1.21000000,5.62000000,2.39000000,],
                    [9.70000000,1.03000000,4.80000000,],
                    [5.45000000,4.24000000,4.95000000,],
                ],
                [
                    [4.66000000,9.00000000,6.88000000,],
                    [6.73000000,0.71000000,6.74000000,],
                    [1.96000000,4.70000000,9.60000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_w_1_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [2.06000000,2.76000000,2.09000000,],
                    [3.94000000,3.93000000,2.42000000,],
                    [2.45000000,3.70000000,3.16000000,],
                ],
                [
                    [3.61000000,2.27000000,3.98000000,],
                    [3.98000000,3.43000000,2.77000000,],
                    [2.19000000,2.95000000,2.52000000,],
                ],
                [
                    [3.84000000,2.29000000,3.91000000,],
                    [2.51000000,2.58000000,2.77000000,],
                    [3.46000000,3.93000000,4.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [2.67000000,2.42000000,3.19000000,],
                    [2.90000000,3.17000000,2.88000000,],
                    [3.67000000,3.60000000,2.30000000,],
                ],
                [
                    [2.75000000,3.56000000,3.80000000,],
                    [2.92000000,3.49000000,2.68000000,],
                    [3.74000000,3.11000000,2.39000000,],
                ],
                [
                    [3.75000000,2.79000000,2.08000000,],
                    [3.88000000,2.64000000,3.97000000,],
                    [2.09000000,2.21000000,3.63000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_w_2_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [-0.61000000,-0.62000000,0.25000000,],
                    [0.90000000,-0.69000000,-0.01000000,],
                    [0.97000000,-0.17000000,0.09000000,],
                ],
                [
                    [-0.45000000,0.27000000,-0.06000000,],
                    [0.33000000,0.12000000,-0.11000000,],
                    [-0.45000000,0.28000000,0.97000000,],
                ],
                [
                    [0.24000000,-0.91000000,-0.09000000,],
                    [-0.26000000,-0.76000000,-0.24000000,],
                    [0.92000000,0.01000000,-0.51000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.37000000,-0.54000000,0.64000000,],
                    [-0.97000000,-0.51000000,0.52000000,],
                    [-0.78000000,0.35000000,-0.04000000,],
                ],
                [
                    [0.24000000,-0.20000000,-0.90000000,],
                    [0.52000000,-0.69000000,0.47000000,],
                    [0.07000000,-0.33000000,0.86000000,],
                ],
                [
                    [-0.50000000,-0.29000000,0.10000000,],
                    [-0.16000000,-0.56000000,-0.85000000,],
                    [-0.24000000,0.56000000,-0.71000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_w_3_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [4.44000000,4.64000000,4.02000000,],
                    [4.10000000,4.15000000,5.07000000,],
                    [4.83000000,5.28000000,4.42000000,],
                ],
                [
                    [4.81000000,4.66000000,5.14000000,],
                    [4.21000000,5.11000000,4.29000000,],
                    [4.92000000,3.82000000,5.34000000,],
                ],
                [
                    [3.59000000,3.58000000,3.53000000,],
                    [5.09000000,5.23000000,4.83000000,],
                    [4.26000000,4.33000000,4.33000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [4.91000000,3.96000000,4.99000000,],
                    [5.20000000,5.18000000,4.03000000,],
                    [4.60000000,3.69000000,4.72000000,],
                ],
                [
                    [5.30000000,5.18000000,4.74000000,],
                    [5.33000000,5.03000000,3.50000000,],
                    [5.41000000,5.06000000,3.97000000,],
                ],
                [
                    [5.19000000,4.82000000,4.98000000,],
                    [4.97000000,4.07000000,3.53000000,],
                    [3.67000000,3.84000000,4.50000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_w_4_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [-1.56000000,-1.43000000,-1.79000000,],
                    [-2.02000000,-1.56000000,-1.88000000,],
                    [-1.45000000,-0.66000000,-2.17000000,],
                ],
                [
                    [-1.10000000,-2.19000000,-0.89000000,],
                    [-1.66000000,-1.04000000,-1.40000000,],
                    [-1.18000000,-0.95000000,-1.09000000,],
                ],
                [
                    [-2.41000000,-1.53000000,-1.03000000,],
                    [-1.16000000,-2.33000000,-1.51000000,],
                    [-2.26000000,-2.49000000,-0.96000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [-0.55000000,-2.31000000,-1.21000000,],
                    [-0.53000000,-2.18000000,-2.24000000,],
                    [-2.06000000,-2.42000000,-0.85000000,],
                ],
                [
                    [-1.37000000,-0.82000000,-0.64000000,],
                    [-0.58000000,-1.64000000,-1.66000000,],
                    [-2.41000000,-0.84000000,-0.53000000,],
                ],
                [
                    [-0.98000000,-2.01000000,-2.39000000,],
                    [-1.96000000,-1.81000000,-2.05000000,],
                    [-1.95000000,-0.55000000,-1.88000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_f_1 = ll.pyarr4d(arg_f_1_nparr, 1, 1)
        arg_w_1 = ll.pyarr4d(arg_w_1_nparr, 1, 1)
        arg_w_2 = ll.pyarr4d(arg_w_2_nparr, 1, 1)
        arg_w_3 = ll.pyarr4d(arg_w_3_nparr, 1, 1)
        arg_w_4 = ll.pyarr4d(arg_w_4_nparr, 1, 1)
        expected_f_eq_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [1.91323377,5.01304046,0.94253524,],
                    [7.00000262,16.27421554,2.86722423,],
                    [0.95274093,2.98306330,0.41211615,],
                ],
                [
                    [0.33603986,3.25256712,0.99879817,],
                    [3.02258685,21.39832238,7.77433039,],
                    [1.38379601,9.85834370,3.24014419,],
                ],
                [
                    [1.92178115,5.65645256,1.28165151,],
                    [6.14559321,20.75515673,4.39582927,],
                    [1.17389871,4.11764163,0.79258631,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [1.24179547,0.66620426,0.69591774,],
                    [8.45824695,13.37257414,0.08694882,],
                    [5.25288803,10.23048710,1.33823377,],
                ],
                [
                    [1.02656246,2.45907655,0.39594571,],
                    [6.24952695,16.63353957,2.79187471,],
                    [2.37233501,6.71180414,0.92994035,],
                ],
                [
                    [1.05691377,6.99470286,2.61072241,],
                    [2.04629838,20.83152005,9.84637695,],
                    [0.83477254,5.24217705,1.65876312,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        expected_f_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [4.97661689,6.39152023,0.63626762,],
                    [4.42000131,8.90210777,5.00861212,],
                    [3.49137046,3.70153165,1.12605807,],
                ],
                [
                    [1.93801993,2.46628356,2.40439908,],
                    [6.36629342,12.85916119,8.26716520,],
                    [1.53189800,9.31917185,6.07507210,],
                ],
                [
                    [3.89089057,4.47322628,3.84582576,],
                    [7.77779661,10.50757836,6.79291464,],
                    [4.33194936,2.57382082,2.62129316,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [3.86589773,0.83310213,1.64795887,],
                    [7.26912348,9.18128707,0.25347441,],
                    [6.98144402,9.52024355,4.08911689,],
                ],
                [
                    [1.11828123,4.03953828,1.39297285,],
                    [7.97476348,8.83176978,3.79593735,],
                    [3.91116750,5.47590207,2.93997018,],
                ],
                [
                    [2.85845688,7.99735143,4.74536120,],
                    [4.38814919,10.77076002,8.29318848,],
                    [1.39738627,4.97108852,5.62938156,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        expected_rho_nparr = np.array([
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,38.65408611,51.22746434,46.81529555,0.00000000,],
            [0.00000000,43.64164814,39.48030272,51.05112356,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
        ])
        expected_u_vert_nparr = np.array([
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,-0.09534424,0.19750030,-0.05730775,0.00000000,],
            [0.00000000,0.32638194,0.14630707,-0.07058245,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
        ])
        expected_u_hori_nparr = np.array([
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
            [0.00000000,-0.15825108,0.13489688,-0.05854076,0.00000000,],
            [0.00000000,-0.27785190,-0.12348770,0.19635099,0.00000000,],
            [0.00000000,0.00000000,0.00000000,0.00000000,0.00000000,],
        ])
        expected_f_eq = ll.pyarr4d(expected_f_eq_nparr, 1, 1)
        expected_f = ll.pyarr4d(expected_f_nparr, 1, 1)
        expected_rho = ll.pyarr2d(expected_rho_nparr, 1, 1)
        expected_u_vert = ll.pyarr2d(expected_u_vert_nparr, 1, 1)
        expected_u_hori = ll.pyarr2d(expected_u_hori_nparr, 1, 1)
        collided_field = ll.CollidedField(4, 5, 1, 1)
        collided_field.collide(arg_f_1, arg_w_1, arg_w_2, arg_w_3, arg_w_4)
        self.assertTrue(isequal_pyarr4d(collided_field.f, expected_f))
        self.assertTrue(isequal_pyarr4d(collided_field.f_eq, expected_f_eq))
        self.assertTrue(isequal_pyarr2d(collided_field.rho, expected_rho))
        self.assertTrue(isequal_pyarr2d(collided_field.u_vert, expected_u_vert))
        self.assertTrue(isequal_pyarr2d(collided_field.u_hori, expected_u_hori))

class TestStreamingWeight(unittest.TestCase):
    """Test class of StreamingWeight
    """

    def test_set_delta_and_get_dw(self):
        arg_eta = 0.10
        arg_f_prev_nparr = np.array([
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [3.24000000,4.44000000,1.84000000,],
                    [1.64000000,1.63000000,2.24000000,],
                    [1.93000000,3.37000000,1.67000000,],
                ],
                [
                    [4.21000000,1.82000000,0.78000000,],
                    [4.34000000,0.08000000,1.15000000,],
                    [1.60000000,2.73000000,1.07000000,],
                ],
                [
                    [2.98000000,0.13000000,2.93000000,],
                    [3.14000000,0.47000000,3.23000000,],
                    [4.31000000,0.84000000,4.78000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [4.16000000,2.93000000,4.22000000,],
                    [1.31000000,5.00000000,1.32000000,],
                    [3.30000000,1.22000000,0.15000000,],
                ],
                [
                    [4.39000000,3.94000000,2.42000000,],
                    [3.25000000,0.66000000,3.98000000,],
                    [0.98000000,4.09000000,3.94000000,],
                ],
                [
                    [0.17000000,1.18000000,3.86000000,],
                    [1.73000000,0.33000000,0.55000000,],
                    [0.25000000,2.13000000,4.69000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [0.77000000,4.07000000,2.99000000,],
                    [4.79000000,0.00000000,1.52000000,],
                    [2.70000000,0.20000000,2.70000000,],
                ],
                [
                    [0.08000000,2.26000000,0.79000000,],
                    [0.33000000,3.22000000,4.47000000,],
                    [4.05000000,1.12000000,3.43000000,],
                ],
                [
                    [3.80000000,1.49000000,3.05000000,],
                    [2.44000000,4.88000000,2.63000000,],
                    [0.34000000,2.91000000,3.72000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
            [
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
                [
                    [2.77000000,4.12000000,1.73000000,],
                    [1.22000000,3.22000000,4.37000000,],
                    [3.22000000,0.47000000,0.53000000,],
                ],
                [
                    [3.16000000,1.13000000,3.00000000,],
                    [2.16000000,1.76000000,4.28000000,],
                    [0.51000000,1.14000000,2.59000000,],
                ],
                [
                    [1.69000000,0.20000000,0.93000000,],
                    [2.58000000,1.81000000,2.91000000,],
                    [4.11000000,2.38000000,2.30000000,],
                ],
                [
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                    [0.00000000,0.00000000,0.00000000,],
                ],
            ],
        ])
        arg_rho_next_nparr = np.array([
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,22.10000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,21.12000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
        ])
        arg_u_vert_next_nparr = np.array([
                [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
                [0.00000000000000,0.00000000000000,0.11493212669683,0.00000000000000,0.00000000000000,],
                [0.00000000000000,0.00000000000000,-0.03645833333333,0.00000000000000,0.00000000000000,],
                [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
            ]
        )
        arg_u_hori_next_nparr = np.array([
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.11085972850679,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.06723484848485,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
        ])
        arg_u_vert_ans_nparr = np.array([
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.28000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,-0.08000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
        ])
        arg_u_hori_ans_nparr = np.array([
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,-0.07000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,-0.08000000000000,0.00000000000000,0.00000000000000,],
            [0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,0.00000000000000,],
        ])
        arg_f_prev = ll.pyarr4d(arg_f_prev_nparr, 0, 1)
        arg_rho_next = ll.pyarr2d(arg_rho_next_nparr, 1, 2)
        arg_u_vert_next = ll.pyarr2d(arg_u_vert_next_nparr, 1, 2)
        arg_u_hori_next = ll.pyarr2d(arg_u_hori_next_nparr, 1, 2)
        arg_u_vert_ans = ll.pyarr2d(arg_u_vert_ans_nparr, 1, 2)
        arg_u_hori_ans = ll.pyarr2d(arg_u_hori_ans_nparr, 1, 2)
        expected_dw_0_nparr = np.array([
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00007633626188,-0.00074203355037,-0.00156040336262,],
                    [0.00082324971574,0.00000487990349,-0.00081348990875,],
                    [0.00157016316960,0.00075179335735,-0.00006657645489,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00094265327312,0.00024551857386,-0.00045161612541,],
                    [0.00073649007868,0.00003935537941,-0.00065777931985,],
                    [0.00053032688424,-0.00016680781503,-0.00086394251430,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
        ])
        expected_dw_1_nparr = np.array([
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00029007779515,-0.00167699582383,-0.00466560605422,],
                    [0.00142422200823,0.00000322073631,-0.00107380667956,],
                    [0.00676740326098,0.00205239586558,-0.00011118267967,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00159308403158,0.00027743598846,-0.00078129589695,],
                    [0.00179703579198,0.00012672432171,-0.00099982456617,],
                    [0.00013258172106,-0.00068224396347,-0.00012959137714,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
            [
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
                [
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                    [0.00000000000000,0.00000000000000,0.00000000000000,],
                ],
            ],
        ])
        expected_delta_nparr = np.array([
            [
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
            ],
            [
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [-0.0007633626188071,0.0074203355036720,0.0156040336261510,],
                    [-0.0082324971574120,-0.0000487990349329,0.0081348990875462,],
                    [-0.0157016316960168,-0.0075179335735378,0.0006657645489413,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
            ],
            [
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [-0.0094265327312434,-0.0024551857385896,0.0045161612540642,],
                    [-0.0073649007867990,-0.0003935537941452,0.0065777931985086,],
                    [-0.0053032688423545,0.0016680781502993,0.0086394251429531,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
            ],
            [
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
                [
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                    [0.0000000000000000,0.0000000000000000,0.0000000000000000,],
                ],
            ],
        ])
        expected_dw_0 = ll.pyarr4d(expected_dw_0_nparr, 1, 2)
        expected_dw_1 = ll.pyarr4d(expected_dw_1_nparr, 1, 2)
        expected_delta = ll.pyarr4d(expected_delta_nparr, 1, 2)
        streaming_weight = ll.StreamingWeight(4, 5, 1, 2)
        got_dw_0, got_dw_1 = streaming_weight.set_delta_and_get_dw(
            arg_eta, arg_f_prev, arg_rho_next, arg_u_vert_next, arg_u_hori_next, arg_u_vert_ans, arg_u_hori_ans
        )
        self.assertTrue(isequal_pyarr4d(expected_dw_0, got_dw_0))
        self.assertTrue(isequal_pyarr4d(expected_dw_1, got_dw_1))
        self.assertTrue(isequal_pyarr4d(expected_delta, streaming_weight.delta))

def isequal_pyarr4d(x, y):
    xH, xW = x.shape[0], x.shape[1]
    yH, yW = y.shape[0], y.shape[1]
    xforbiddenH, xforbiddenW = x.forbidden_at[0], x.forbidden_at[1]
    yforbiddenH, yforbiddenW = y.forbidden_at[0], y.forbidden_at[1]

    if xH != yH or xW != yW:
        return False
    if xforbiddenH != yforbiddenH or xforbiddenW != yforbiddenW:
        return False
    # pprint.pprint(x.arr[xforbiddenH:-xforbiddenH, xforbiddenW:-xforbiddenW, :, :])
    # pprint.pprint(y.arr[yforbiddenH:-yforbiddenH, yforbiddenW:-yforbiddenW, :, :])
    np.testing.assert_array_almost_equal(x.arr[xforbiddenH:-xforbiddenH, xforbiddenW:-xforbiddenW, :, :],
        y.arr[yforbiddenH:-yforbiddenH, yforbiddenW:-yforbiddenW, :, :])
    return np.allclose(x.arr[xforbiddenH:-xforbiddenH, xforbiddenW:-xforbiddenW, :, :], 
        y.arr[yforbiddenH:-yforbiddenH, yforbiddenW:-yforbiddenW, :, :])

def isequal_pyarr2d(x, y):
    xH, xW = x.shape[0], x.shape[1]
    yH, yW = y.shape[0], y.shape[1]
    xforbiddenH, xforbiddenW = x.forbidden_at[0], x.forbidden_at[1]
    yforbiddenH, yforbiddenW = y.forbidden_at[0], y.forbidden_at[1]

    if xH != yH or xW != yW:
        return False
    if xforbiddenH != yforbiddenH or xforbiddenW != yforbiddenW:
        return False
    np.testing.assert_array_almost_equal(x.arr[xforbiddenH:-xforbiddenH, xforbiddenW:-xforbiddenW],
        y.arr[yforbiddenH:-yforbiddenH, yforbiddenW:-yforbiddenW])
    return np.allclose(x.arr[xforbiddenH:-xforbiddenH, xforbiddenW:-xforbiddenW], 
        y.arr[yforbiddenH:-yforbiddenH, yforbiddenW:-yforbiddenW])


if __name__ == "__main__":
    unittest.main()
